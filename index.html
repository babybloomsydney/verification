<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Baby Bloom Verification</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f8f9fa; padding: 6px; font-size: 12px; line-height: 1.3; }
        .header { text-align: center; margin-bottom: 6px; }
        h1 { font-size: 13px; color: #1a3c6e; }
        .submitted { font-size: 9px; color: #6c757d; opacity: 0.7; margin-top: 1px; }
        .container { display: flex; flex-direction: column; height: 100vh; max-height: 100vh; overflow: hidden; position: relative; padding-bottom: 50px; }
        .images { display: flex; gap: 6px; margin-bottom: 6px; }
        .images img { width: 48%; height: auto; max-height: 160px; object-fit: contain; border: 1.5px solid #1a3c6e; border-radius: 5px; cursor: zoom-in; }
        .comparison { display: flex; gap: 6px; flex: 1 0 auto; margin-bottom: 6px; overflow: hidden; }
        .col { flex: 1; background: #fff; padding: 4px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .col h2 { font-size: 11px; color: #1a3c6e; margin-bottom: 2px; font-weight: 600; }
        .row { display: flex; justify-content: space-between; margin-bottom: 1px; font-size: 11px; }
        .row label { font-weight: 600; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .row span { flex: 2; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .contact, .issues, .comments { background: #fff; padding: 4px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); margin-bottom: 6px; }
        .contact h2, .issues h2, .comments h2 { font-size: 11px; color: #1a3c6e; margin-bottom: 2px; }
        .issues ul { list-style: disc; padding-left: 12px; margin: 0; font-size: 10.5px; color: #dc3545; }
        .issues li { margin-bottom: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .comments textarea { width: 100%; height: 36px; font-size: 10.5px; padding: 3px; border: 1px solid #ced4da; border-radius: 4px; resize: none; }
        .buttons { position: fixed; bottom: 0; left: 0; right: 0; display: flex; gap: 6px; padding: 6px; background: #f8f9fa; border-top: 1px solid #dee2e6; z-index: 100; }
        .verify-btn { background: #28a745; color: #fff; flex: 1; }
        .fail-btn { background: #dc3545; color: #fff; flex: 1; }
        .verify-btn, .fail-btn { padding: 9px; border: none; border-radius: 5px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .verify-btn:hover { background: #218838; }
        .fail-btn:hover { background: #c82333; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; justify-content: center; align-items: center; padding: 20px; }
        .modal img { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 6px; }
        .modal.active { display: flex; }

        @media (max-width: 600px) {
            .comparison { flex-direction: column; }
            .images img { max-height: 130px; }
            .row { font-size: 10.5px; }
            .col h2, .contact h2, .issues h2, .comments h2 { font-size: 10.5px; }
            .buttons { flex-direction: row; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Verification</h1>
            <div class="submitted" id="submitted"></div>
        </div>
        <div class="images">
            <img id="passportImg" alt="Passport">
            <img id="idImg" alt="ID">
        </div>
        <div class="comparison">
            <div class="col">
                <h2>Personal Details</h2>
                <div class="row"><label>Contact ID</label><span id="contactId"></span></div>
                <div class="row"><label>Surname</label><span id="surname"></span></div>
                <div class="row"><label>Given Name(s)</label><span id="givenNames"></span></div>
                <div class="row"><label>Date of Birth</label><span id="dob"></span></div>
                <div class="row"><label>Nationality</label><span id="nationality"></span></div>
            </div>
            <div class="col">
                <h2>Passport Details</h2>
                <div class="row"><label>Surname</label><span id="passportSurname"></span></div>
                <div class="row"><label>Given Name(s)</label><span id="passportGivenNames"></span></div>
                <div class="row"><label>Date of Birth</label><span id="passportDob"></span></div>
                <div class="row"><label>Nationality</label><span id="passportNationality"></span></div>
                <div class="row"><label>Number</label><span id="passportNumber"></span></div>
                <div class="row"><label>Expiry</label><span id="passportExpiry"></span></div>
            </div>
        </div>
        <div class="contact">
            <h2>Contact Details</h2>
            <div class="row"><label>Email</label><span id="email"></span></div>
            <div class="row"><label>Phone</label><span id="phone"></span></div>
            <div class="row"><label>Address</label><span id="addressLine1"></span></div>
            <div class="row"><label>City / Zip</label><span id="cityZip"></span></div>
            <div class="row"><label>Country</label><span id="addressCountry"></span></div>
        </div>
        <div class="issues">
            <h2>AI Flagged Issues</h2>
            <ul id="issuesList"></ul>
        </div>
        <div class="comments">
            <h2>Comments (if failed)</h2>
            <textarea id="comments" placeholder="Enter reason for failure..."></textarea>
        </div>
    </div>

    <div class="buttons">
        <button class="verify-btn" id="verify-btn">VERIFY USER</button>
        <button class="fail-btn" id="fail-btn">VERIFICATION FAILED</button>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <img id="modalImg" alt="Enlarged">
    </div>

    <script>
        const params = new URLSearchParams(location.search);
        const encoded = params.get('data');
        const contactId = params.get('id');

        let data = {};
        if (encoded) {
            try { data = JSON.parse(atob(encoded)); }
            catch(e) { alert('Invalid data'); }
        }

        document.getElementById('contactId').textContent = data.contactId || '—';
        document.getElementById('submitted').textContent = data.verificationSubmitTimestamp || '—';
        const passportImg = document.getElementById('passportImg');
        const idImg = document.getElementById('idImg');
        passportImg.src = data.passportUrl || '';
        idImg.src = data.idPhotoUrl || '';
        document.getElementById('surname').textContent = data.lastName || '—';
        document.getElementById('givenNames').textContent = data.firstName || '—';
        document.getElementById('dob').textContent = data.dob || '—';
        document.getElementById('nationality').textContent = data.nationality || '—';
        document.getElementById('passportSurname').textContent = data.extracted.surname || '—';
        document.getElementById('passportGivenNames').textContent = data.extracted.givenNames || '—';
        document.getElementById('passportDob').textContent = data.extracted.dob || '—';
        document.getElementById('passportNationality').textContent = data.extracted.nationality || '—';
        document.getElementById('passportNumber').textContent = data.passportNumber || '—';
        document.getElementById('passportExpiry').textContent = data.passportExpiry || '—';
        document.getElementById('email').textContent = data.email || '—';
        document.getElementById('phone').textContent = data.phoneNumber || '—';
        document.getElementById('addressLine1').textContent = data.addressLine1 || '—';
        document.getElementById('cityZip').textContent = (data.addressCity || '') + ' ' + (data.addressZip || '');
        document.getElementById('addressCountry').textContent = data.addressCountry || '—';

        const issuesList = document.getElementById('issuesList');
        if (data.issues && data.issues.length > 0) {
            data.issues.forEach(issue => {
                const li = document.createElement('li');
                li.textContent = issue;
                issuesList.appendChild(li);
            });
        } else {
            const li = document.createElement('li');
            li.textContent = 'None';
            issuesList.appendChild(li);
        }

        // Modal Logic
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modalImg');
        [passportImg, idImg].forEach(img => {
            img.onclick = () => {
                modalImg.src = img.src;
                modal.classList.add('active');
            };
        });
        modal.onclick = () => modal.classList.remove('active');

        // Verify Button
        document.getElementById('verify-btn').addEventListener('click', async () => {
            if (!confirm('Mark as VERIFIED?')) return;
            const res = await fetch('https://hook.make.com/YOUR_VERIFY_WEBHOOK', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({contactId: contactId, status: 'verified'})
            });
            if (res.ok) {
                alert('Verified!');
                document.getElementById('verify-btn').disabled = true;
                document.getElementById('verify-btn').textContent = 'VERIFIED';
            } else {
                alert('Error');
            }
        });

        // Fail Button
        document.getElementById('fail-btn').addEventListener('click', async () => {
            const comments = document.getElementById('comments').value.trim();
            if (!comments) {
                alert('Please enter comments for failure.');
                return;
            }
            if (!confirm('Mark as FAILED and notify user?')) return;
            const res = await fetch('https://hook.make.com/YOUR_FAIL_WEBHOOK', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    contactId: contactId,
                    verificationStatus: 'FAILED',
                    comments: comments
                })
            });
            if (res.ok) {
                alert('Failure recorded and user notified.');
                document.getElementById('fail-btn').disabled = true;
                document.getElementById('fail-btn').textContent = 'FAILED SENT';
            } else {
                alert('Error');
            }
        });
    </script>
</body>
</html>
